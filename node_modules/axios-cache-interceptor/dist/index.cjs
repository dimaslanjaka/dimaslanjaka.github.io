// Axios Cache Interceptor v1.0.1 MIT License Copyright (c) 2021-present Arthur Fiorette & Contributors
(()=>{"use strict";var e={d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Header:()=>r,buildKeyGenerator:()=>b,buildMemoryStorage:()=>v,buildStorage:()=>w,buildWebStorage:()=>C,canStale:()=>p,createCacheResponse:()=>d,createValidateStatus:()=>s,defaultHeaderInterpreter:()=>o,defaultKeyGenerator:()=>x,defaultRequestInterceptor:()=>u,defaultResponseInterceptor:()=>h,isExpired:()=>m,isMethodIn:()=>i,isStorage:()=>g,setupCache:()=>I,testCachePredicate:()=>f,updateCache:()=>l,updateStaleRequest:()=>c});const a=require("cache-parser"),r=Object.freeze({IfModifiedSince:"if-modified-since",LastModified:"last-modified",IfNoneMatch:"if-none-match",CacheControl:"cache-control",Pragma:"pragma",ETag:"etag",Expires:"expires",Age:"age",XAxiosCacheEtag:"x-axios-cache-etag",XAxiosCacheLastModified:"x-axios-cache-last-modified",XAxiosCacheStaleIfError:"x-axios-cache-stale-if-error"}),o=e=>{if(!e)return"not enough headers";const t=e[r.CacheControl];if(t){const{noCache:o,noStore:n,mustRevalidate:s,maxAge:i,immutable:c}=(0,a.parse)(String(t));if(o||n)return"dont cache";if(c)return 31536e6;if(s)return 0;if(void 0!==i){const t=e[r.Age];return t?1e3*(i-Number(t)):1e3*i}}const o=e[r.Expires];if(o){const e=Date.parse(String(o))-Date.now();return e>=0?e:"dont cache"}return"not enough headers"},n=require("fast-defer");function s(e){return e?t=>e(t)||304===t:e=>e>=200&&e<300||304===e}function i(e="get",t=[]){return e=e.toLowerCase(),t.some((t=>t===e))}function c(e,t){var a;t.headers||(t.headers={});const{etag:o,modifiedSince:n}=t.cache;if(o){const n=!0===o?null===(a=e.data)||void 0===a?void 0:a.headers[r.ETag]:o;n&&(t.headers[r.IfNoneMatch]=n)}n&&(t.headers[r.IfModifiedSince]=!0===n?e.data.headers[r.LastModified]||new Date(e.createdAt).toUTCString():n.toUTCString())}function d(e,t){return 304===e.status&&t?(e.cached=!0,e.data=t.data,e.status=t.status,e.statusText=t.statusText,e.headers=Object.assign(Object.assign({},t.headers),e.headers),t):{data:e.data,status:e.status,statusText:e.statusText,headers:e.headers}}function u(e){const t=async t=>{var a,o,d,u,f,l,h,g,p;const m=t.id=e.generateKey(t);if(!1===t.cache)return t;if(t.cache=Object.assign(Object.assign({},e.defaults.cache),t.cache),t.cache.cacheTakeover&&(null!==(a=(u=t.headers)[f=r.CacheControl])&&void 0!==a||(u[f]="no-cache"),null!==(o=(l=t.headers)[h=r.Pragma])&&void 0!==o||(l[h]="no-cache"),null!==(d=(g=t.headers)[p=r.Expires])&&void 0!==d||(g[p]="0")),!i(t.method,t.cache.methods))return t;let w=await e.storage.get(m,t);const v=t.cache.override;e:if("empty"===w.state||"stale"===w.state||v){if(e.waiting[m]&&!v&&(w=await e.storage.get(m,t),"empty"!==w.state)){0;break e}return e.waiting[m]=(0,n.deferred)(),e.waiting[m].catch((()=>{})),await e.storage.set(m,{state:"loading",previous:v?w.data?"stale":"empty":w.state,data:w.data,createdAt:v&&!w.createdAt?Date.now():w.createdAt},t),"stale"===w.state&&c(w,t),t.validateStatus=s(t.validateStatus),t}let y;if("loading"===w.state){const a=e.waiting[m];if(!a)return await e.storage.remove(m,t),t;0;try{y=await a}catch(e){return t}}else y=w.data;return t.adapter=()=>Promise.resolve({config:t,data:y.data,headers:y.headers,status:y.status,statusText:y.statusText,cached:!0,id:m}),t};return{onFulfilled:t,apply:()=>e.interceptors.request.use(t)}}async function f(e,t){var a;if("function"==typeof t)return t(e);const{statusCheck:r,responseMatch:o,containsHeaders:n}=t;if(r&&!await r(e.status)||o&&!await o(e))return!1;if(n)for(const[t,r]of Object.entries(n))if(!await r(null!==(a=e.headers[t.toLowerCase()])&&void 0!==a?a:e.headers[t]))return!1;return!0}async function l(e,t,a){if("function"==typeof a)return a(t);for(const[r,o]of Object.entries(a)){if("delete"===o){await e.remove(r,t.config);continue}const a=await e.get(r,t.config);if("loading"===a.state)continue;const n=await o(a,t);"delete"!==n?"ignore"!==n&&await e.set(r,n,t.config):await e.remove(r,t.config)}}function h(e){const t=async(t,a)=>{var r;await e.storage.remove(t,a),null===(r=e.waiting[t])||void 0===r||r.reject(),delete e.waiting[t]},a=async a=>{var o,n,s;const c=a.id=null!==(o=(s=a.config).id)&&void 0!==o?o:s.id=e.generateKey(a.config);if(null!==(n=a.cached)&&void 0!==n||(a.cached=!1),a.cached)return a;const u=a.config,h=u.cache;if(!h)return Object.assign(Object.assign({},a),{cached:!1});if(h.update&&await l(e.storage,a,h.update),!i(u.method,h.methods))return a;const g=await e.storage.get(c,u);if("loading"!==g.state)return a;if(!g.data&&!await f(a,h.cachePredicate))return await t(c,u),a;for(const e of Object.keys(a.headers))e.startsWith("x-axios-cache")&&delete a.headers[e];h.etag&&!0!==h.etag&&(a.headers[r.XAxiosCacheEtag]=h.etag),h.modifiedSince&&(a.headers[r.XAxiosCacheLastModified]=!0===h.modifiedSince?"use-cache-timestamp":h.modifiedSince.toUTCString());let p=h.ttl||-1;if(h.interpretHeader){const r=e.headerInterpreter(a.headers);if("dont cache"===r)return await t(c,u),a;p="not enough headers"===r?p:r}const m=d(a,g.data);"function"==typeof p&&(p=await p(a)),h.staleIfError&&(a.headers[r.XAxiosCacheStaleIfError]=String(p));const w={state:"cached",ttl:p,createdAt:Date.now(),data:m},v=e.waiting[c];return v&&(v.resolve(w.data),delete e.waiting[c]),await e.storage.set(c,w,u),a},o=async a=>{var r;const o=a.config,n=o.id,s=o.cache;if(!s||!n)throw a;if(!i(o.method,s.methods))throw a;const c=await e.storage.get(n,o);if("loading"!==c.state||"stale"!==c.previous)throw await t(n,o),a;if(s.staleIfError){const t="function"==typeof s.staleIfError?await s.staleIfError(a.response,c,a):s.staleIfError;if(!0===t||"number"==typeof t&&c.createdAt+t>Date.now())return null===(r=e.waiting[n])||void 0===r||r.resolve(c.data),delete e.waiting[n],await e.storage.set(n,{state:"stale",createdAt:Date.now(),data:c.data},o),{cached:!0,config:o,id:n,data:c.data.data,headers:c.data.headers,status:c.data.status,statusText:c.data.statusText}}throw a};return{onFulfilled:a,onRejected:o,apply:()=>e.interceptors.response.use(a,o)}}const g=e=>!!e&&!!e["is-storage"];function p(e){const t=e.data.headers;return r.ETag in t||r.LastModified in t||r.XAxiosCacheEtag in t||r.XAxiosCacheStaleIfError in t||r.XAxiosCacheLastModified in t}function m(e){return e.createdAt+e.ttl<=Date.now()}function w({set:e,find:t,remove:a}){return{"is-storage":1,set:e,remove:a,get:async(r,o)=>{const n=await t(r,o);if(!n)return{state:"empty"};if("cached"!==n.state||!m(n))return n;if(p(n)){const t={state:"stale",createdAt:n.createdAt,data:n.data};return await e(r,t,o),t}return await a(r,o),{state:"empty"}}}}function v(e=!1){const t=w({set:(e,a)=>{t.data[e]=a},remove:e=>{delete t.data[e]},find:a=>{const r=t.data[a];return e&&void 0!==r?"function"==typeof structuredClone?structuredClone(r):JSON.parse(JSON.stringify(r)):r}});return t.data=Object.create(null),t}const y=require("object-code"),S=/^\/|\/$/g;function b(e){return t=>{if(t.id)return t.id;const a=e(t);return"string"==typeof a||"number"==typeof a?`${a}`:`${(0,y.hash)(a)}`}}const x=b((({baseURL:e="",url:t="",method:a="get",params:r,data:o})=>(e&&(e=e.replace(S,"")),t&&(t=t.replace(S,"")),a&&(a=a.toLowerCase()),{url:e+(e&&t?"/":"")+t,params:r,method:a,data:o})));function I(e,t={}){var a,r,n,s,i,c;const d=e;if(d.defaults.cache)throw new Error("setupCache() should be called only once");if(d.storage=t.storage||v(),!g(d.storage))throw new Error("Use buildStorage() function");return d.waiting=t.waiting||{},d.generateKey=t.generateKey||x,d.headerInterpreter=t.headerInterpreter||o,d.requestInterceptor=t.requestInterceptor||u(d),d.responseInterceptor=t.responseInterceptor||h(d),d.debug=t.debug,d.defaults.cache={update:t.update||{},ttl:null!==(a=t.ttl)&&void 0!==a?a:3e5,methods:t.methods||["get"],cachePredicate:t.cachePredicate||{statusCheck:e=>e>=200&&e<400},etag:null===(r=t.etag)||void 0===r||r,modifiedSince:null!==(n=t.modifiedSince)&&void 0!==n?n:!1===t.etag,interpretHeader:null===(s=t.interpretHeader)||void 0===s||s,cacheTakeover:null===(i=t.cacheTakeover)||void 0===i||i,staleIfError:null===(c=t.staleIfError)||void 0===c||c,override:!1},d.requestInterceptor.apply(),d.responseInterceptor.apply(),d}function C(e,t="axios-cache-"){return w({find:a=>{const r=e.getItem(t+a);return r?JSON.parse(r):void 0},remove:a=>{e.removeItem(t+a)},set:(a,r)=>{const o=()=>e.setItem(t+a,JSON.stringify(r));try{return o()}catch(r){const n=Object.entries(e).filter((e=>e[0].startsWith(t))).map((e=>[e[0],JSON.parse(e[1])]));for(const t of n)"cached"===t[1].state&&m(t[1])&&!p(t[1])&&e.removeItem(t[0]);try{return o()}catch(t){const a=n.sort(((e,t)=>(e[1].createdAt||0)-(t[1].createdAt||0)));for(const t of a){e.removeItem(t[0]);try{return o()}catch(e){}}}e.removeItem(t+a)}}})}module.exports=t})();