<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.webmanajemen.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.13.1","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Provide ApplicationEventPublisher for Spring WebFlux ApplicationEventPublisher is provided in Spring for publishing events, which is useful in some scenarios, for example, when I create an item, and a">
<meta property="og:type" content="article">
<meta property="og:title" content="Provide ApplicationEventPublisher for Spring WebFlux">
<meta property="og:url" content="https://www.webmanajemen.com/2020/10/provide-applicationeventpublisher-for-spring-webflux.html">
<meta property="og:site_name" content="WMI">
<meta property="og:description" content="Provide ApplicationEventPublisher for Spring WebFlux ApplicationEventPublisher is provided in Spring for publishing events, which is useful in some scenarios, for example, when I create an item, and a">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-09T18:35:48.000Z">
<meta property="article:modified_time" content="2022-11-09T19:08:23.000Z">
<meta property="article:author" content="Dimas Lanjaka">
<meta property="article:tag" content="java">
<meta property="article:tag" content="springboot">
<meta property="article:tag" content="webflux">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.webmanajemen.com/2020/10/provide-applicationeventpublisher-for-spring-webflux.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://www.webmanajemen.com/2020/10/provide-applicationeventpublisher-for-spring-webflux.html","path":"/2020/10/provide-applicationeventpublisher-for-spring-webflux.html","title":"Provide ApplicationEventPublisher for Spring WebFlux"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Provide ApplicationEventPublisher for Spring WebFlux | WMI</title>
  
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-106238155-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-106238155-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>





<style>
  /* fix index title overload the body width */
  a.post-title-link {
    max-width: 100%;
  }
  /* fix long image in homepage */
  .main-inner.index .post-gallery .post-gallery-image img {
    height: 300px;
    object-fit: cover;
    opacity: 1;
    width: 100%;
    object-position: top;
  }
</style>
<link rel="stylesheet" type="text/css" href="/css/injector/main.css">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link id="rss-site-url" type="application/rss+xml" rel="alternate" href="https://www.webmanajemen.com/rss.xml"><link id="atom-site-url" type="application/atom+xml" rel="alternate" href="https://www.webmanajemen.com/atom.xml"></head>

<body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">WMI</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Website Management Indonesia</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-privacy"><a href="/p/privacy.html" rel="section"><i class="fa fa-shield fa-fw"></i>privacy</a></li><li class="menu-item menu-item-tos"><a href="/p/tos.html" rel="section"><i class="fa fa-shield fa-fw"></i>tos</a></li><li class="menu-item menu-item-chimeraland"><a href="/chimeraland" rel="section"><i class="fa fa-archive fa-fw"></i>chimeraland</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Implement-the-Event-service"><span class="nav-number">1.</span> <span class="nav-text">Implement the Event service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ObjectEventNotifier"><span class="nav-number">2.</span> <span class="nav-text">ObjectEventNotifier</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EventListener"><span class="nav-number">3.</span> <span class="nav-text">EventListener</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EventService"><span class="nav-number">4.</span> <span class="nav-text">EventService</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Try-the-written-Event-service"><span class="nav-number">5.</span> <span class="nav-text">Try the written Event service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-source-code-is-here"><span class="nav-number">6.</span> <span class="nav-text">The source code is here</span></a></li></ol></div>
        </div>
        

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Dimas Lanjaka</p>
  <div class="site-description" itemprop="description">Website Management Indonesia is a blog about scripts, tips and tricks, games, software. Covering php, javascript, jquery, mysql, seo, e-commerce and others.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">1464</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">130</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://www.webmanajemen.com/page/safelink.html?url=aHR0cHM6Ly9naXRodWIuY29tL2RpbWFzbGFuamFrYQ==" title="GitHub → https://github.com/dimaslanjaka" rel="nofollow noopener noreferer noreferrer external" target="_blank" alt="Provide ApplicationEventPublisher for Spring WebFlux"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:dimaslanjaka@gmail.com" title="E-Mail → mailto:dimaslanjaka@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.webmanajemen.com/page/safelink.html?url=aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3NlY3JldG5ldHdvcmtmb3JjZXM=" title="FB Page → https://www.facebook.com/secretnetworkforces" rel="nofollow noopener noreferer noreferrer external" target="_blank" alt="Provide ApplicationEventPublisher for Spring WebFlux"><i class="fab fa-facebook fa-fw"></i>FB Page</a>
      </span>
  </div>


<ul itemscope="" itemtype="https://schema.org/ItemList" id="sidebar-widget">
  <li itemprop="itemListElement" itemscope="" itemtype="https://schema.org/ListItem">
    <a itemprop="item" href="https://webmanajemen.com/page/moment-timezone.html" rel="internal follow bookmark" alt="Provide ApplicationEventPublisher for Spring WebFlux" title="Provide ApplicationEventPublisher for Spring WebFlux">
    <span itemprop="name">Moment Timezone Playground <small>(moment-timezone)</small></span></a>
    <meta itemprop="position" content="1">
  </li>
  <li itemprop="itemListElement" itemscope="" itemtype="https://schema.org/ListItem">
    <a itemprop="item" href="https://www.webmanajemen.com/page/bot-detect" rel="internal follow bookmark" alt="Provide ApplicationEventPublisher for Spring WebFlux" title="Provide ApplicationEventPublisher for Spring WebFlux">
    <span itemprop="name">Is Iam Bot? <small>(selenium checker)</small></span></a>
    <meta itemprop="position" content="2">
  </li>
  <li itemprop="itemListElement" itemscope="" itemtype="https://schema.org/ListItem">
    <a itemprop="item" href="https://www.webmanajemen.com/chimeraland/blacklist-player.html" rel="internal follow bookmark" alt="Provide ApplicationEventPublisher for Spring WebFlux" title="Provide ApplicationEventPublisher for Spring WebFlux">
    <span itemprop="name">Chimeraland Scammer List</span></a>
    <meta itemprop="position" content="3">
  </li>
</ul>
<style>
  #sidebar-widget a {
    text-align: left;
    font-size: 15px;
  }
</style>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.webmanajemen.com/2020/10/provide-applicationeventpublisher-for-spring-webflux.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Dimas Lanjaka">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WMI">
      <meta itemprop="description" content="Website Management Indonesia is a blog about scripts, tips and tricks, games, software. Covering php, javascript, jquery, mysql, seo, e-commerce and others.">
    </span>

    <span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Provide ApplicationEventPublisher for Spring WebFlux | WMI">
      <meta itemprop="description" content="Provide ApplicationEventPublisher for Spring WebFlux ApplicationEventPublisher is provided in Spring for publishing events, which is useful in some scenarios, for example, when I create an item, and another service listens for item creation and creates inventory for it. So its very practical in S">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Provide ApplicationEventPublisher for Spring WebFlux
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-11-10 01:35:48 / Modified: 02:08:23" itemprop="dateCreated datePublished" datetime="2022-11-10T01:35:48+07:00">2022-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">programming</span></a>
        </span>
          , 
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/programming/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/10/provide-applicationeventpublisher-for-spring-webflux.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="/2020/10/provide-applicationeventpublisher-for-spring-webflux.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

            <div class="post-description">Provide ApplicationEventPublisher for Spring WebFlux ApplicationEventPublisher is provided in Spring for publishing events, which is useful in some scenarios, for example, when I create an item, and another service listens for item creation and creates inventory for it. So its very practical in S</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>ApplicationEventPublisher is provided in Spring for publishing events, which is useful in some scenarios, for example, when I create an item, and another service listens for item creation and creates inventory for it. So it’s very practical in Spring MVC, and I often use it for decoupling, but when I switch to WebFlux, it’s embarrassing. Because ApplicationEventPublisher is a synchronous operation, it does not support reactive, ie streaming operations.</p>
<p>So, I implement a similar publish-subscribe pattern in WebFlux to replace ApplicationEventPublisher</p>
<h2 id="Implement-the-Event-service"><a href="#Implement-the-Event-service" class="headerlink" title="Implement the Event service"></a>Implement the Event service</h2><p>Our event service is divided into 3 parts</p>
<ul>
<li>Encapsulation of published objects</li>
<li>Design a common listening interface</li>
<li>Provide an object like ApplicationEventPublisher to publish events</li>
</ul>
<h2 id="ObjectEventNotifier"><a href="#ObjectEventNotifier" class="headerlink" title="ObjectEventNotifier"></a>ObjectEventNotifier</h2><p>First, encapsulate the published object. This step is unavoidable even if it is ApplicationEventPublisher. Otherwise, you listen to an object, but you don’t know whether the object is created or deleted. What should you do?</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObjectEventNotifier</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">ResolvableTypeProvider</span> {

    <span class="keyword">private</span> <span class="keyword">final</span> T object;
    <span class="keyword">private</span> <span class="keyword">final</span> Type type;

    <span class="keyword">private</span> <span class="title function_">ObjectEventNotifier</span><span class="params">(T object, Type type)</span> {
        <span class="built_in">this</span>.object = object;
        <span class="built_in">this</span>.type = type;
    }

    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ObjectEventNotifier&lt;T&gt; <span class="title function_">from</span><span class="params">(T object, Type type)</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ObjectEventNotifier</span>&lt;&gt;(object, type);
    }

    <span class="meta">@Override</span>
    <span class="keyword">public</span> ResolvableType <span class="title function_">getResolvableType</span><span class="params">()</span> {
        <span class="keyword">return</span> ResolvableType.forClassWithGenerics(getClass(), ResolvableType.forInstance(object));
    }

    <span class="keyword">public</span> T <span class="title function_">getObject</span><span class="params">()</span> {
        <span class="keyword">return</span> <span class="built_in">this</span>.object;
    }

    <span class="keyword">public</span> Type <span class="title function_">getType</span><span class="params">()</span> {
        <span class="keyword">return</span> <span class="built_in">this</span>.type;
    }

    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Type</span> {
        Create, Update, Delete
    }
}</code></pre>

<p>The above class, according to the enumeration Type, classifies objects so that they can be handled differently in different situations</p>
<h2 id="EventListener"><a href="#EventListener" class="headerlink" title="EventListener"></a>EventListener</h2><p>Next, design the listening interface. Generally speaking, we choose different consumers according to the type of class. Therefore, the simple listening interface is as follows</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EventListener</span>&lt;T&gt; {

    Class&lt;T&gt; <span class="title function_">target</span><span class="params">()</span>;

    Publisher&lt;Void&gt; <span class="title function_">consume</span><span class="params">(ObjectEventNotifier&lt;T&gt; consumer)</span>;

}</code></pre>

<p>But in this way, there is a problem, when we create a listening service, it will be like the following</p>
<pre><code class="highlight java"><span class="meta">@Bean</span>
<span class="keyword">public</span> EventListener&lt;Goods&gt; <span class="title function_">listener</span><span class="params">()</span> {
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EventListener</span>&lt;&gt;() {
        <span class="meta">@Override</span>
        <span class="keyword">public</span> Class&lt;Goods&gt; <span class="title function_">target</span><span class="params">()</span> {
            <span class="keyword">return</span> Goods.class;
        }
        <span class="meta">@Override</span>
        <span class="keyword">public</span> Publisher&lt;Void&gt; <span class="title function_">consume</span><span class="params">(ObjectEventNotifier&lt;Goods&gt; consumer)</span> {
            <span class="comment">// ...</span>
        }
    };
}</code></pre>

<p>This code is really hard to describe, so a simplified version of the creation method must be provided for the listening interface</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EventListener</span>&lt;T&gt; {
    <span class="comment">//...</span>
    <span class="keyword">static</span> &lt;T&gt; EventListener&lt;T&gt; <span class="title function_">register</span><span class="params">(Class&lt;T&gt; target, Function&lt;ObjectEventNotifier&lt;T&gt;, Publisher&lt;Void&gt;&gt; fn)</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EventListener</span>&lt;&gt;() {
            <span class="meta">@Override</span>
            <span class="keyword">public</span> Class&lt;T&gt; <span class="title function_">target</span><span class="params">()</span> {
                <span class="keyword">return</span> target;
            }
            <span class="meta">@Override</span>
            <span class="keyword">public</span> Publisher&lt;Void&gt; <span class="title function_">consume</span><span class="params">(ObjectEventNotifier&lt;T&gt; consumer)</span> {
                <span class="keyword">return</span> fn.apply(consumer);
            }
        };
    }
}

<span class="meta">@Bean</span>
<span class="keyword">public</span> EventListener&lt;Goods&gt; <span class="title function_">listener</span><span class="params">()</span> {
    <span class="keyword">return</span> EventListener.register(Goods.class, notifier -&gt; ...);
}</code></pre>

<p>so much better</p>
<h2 id="EventService"><a href="#EventService" class="headerlink" title="EventService"></a>EventService</h2><p>Finally, implement our most important event service, which is divided into two parts</p>
<ul>
<li>Receive listening services and classify based on class type</li>
<li>Accept the published object, encapsulate and select the corresponding monitoring service consumption according to the type</li>
</ul>
<p>In the first part, since we use Spring boot, we can let spring give us the listening service we want. We only need to store the EventListener in different Maps according to the type.</p>
<pre><code class="highlight java"><span class="meta">@Service</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventService</span> {

    <span class="keyword">public</span> Map&lt;String, List&lt;Object&gt;&gt; store = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="meta">@SuppressWarnings({"unchecked", "rawtypes"})</span>
    <span class="keyword">public</span> <span class="title function_">EventService</span><span class="params">(List&lt;EventListener&gt; listeners)</span> {
        listeners.forEach(listener -&gt; {
            <span class="built_in">this</span>.register(listener.target(), listener::consume);
        });
    }

    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(Class&lt;T&gt; target, Function&lt;ObjectEventNotifier&lt;T&gt;, Publisher&lt;Void&gt;&gt; consumer)</span> {
        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> target.getName();
        List&lt;Object&gt; consumers = store.getOrDefault(name, <span class="literal">null</span>);
        <span class="keyword">if</span> (consumers == <span class="literal">null</span>) {
            consumers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();
            store.put(name, consumers);
        }
        consumers.add(consumer);
    }
}</code></pre>

<p>The second part, this is the difficulty in reactive. The reactive is non-blocking, so the consumer also needs to return a non-blocking result. The previous interface returned YES <code>Publisher&lt;Void&gt;</code> because this is an unprocessed result.</p>
<pre><code class="highlight java"><span class="meta">@Service</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventService</span> {

    <span class="keyword">public</span> Map&lt;String, List&lt;Object&gt;&gt; store = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="meta">@SuppressWarnings({"unchecked"})</span>
    <span class="keyword">public</span> &lt;T&gt; Flux&lt;Void&gt; <span class="title function_">publish</span><span class="params">(ObjectEventNotifier.Type type, T target)</span> {
        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> target.getClass().getName();
        List&lt;Object&gt; consumers = store.getOrDefault(name, <span class="literal">null</span>);
        <span class="keyword">if</span> (consumers == <span class="literal">null</span>) {
            <span class="keyword">return</span> Flux.empty();
        }
        <span class="keyword">return</span> Flux
            .fromIterable(consumers)
            .flatMap(obj -&gt; {
                Function&lt;ObjectEventNotifier&lt;T&gt;, Publisher&lt;Void&gt;&gt; consumer = (Function&lt;ObjectEventNotifier&lt;T&gt;, Publisher&lt;Void&gt;&gt;) obj;
                Publisher&lt;Void&gt; apply = consumer.apply(ObjectEventNotifier.from(target, type));
                <span class="keyword">return</span> apply == <span class="literal">null</span> ? Mono.empty() : apply;
            });
    }

    <span class="keyword">public</span> &lt;T&gt; Mono&lt;T&gt; <span class="title function_">publishCreate</span><span class="params">(T target)</span> {
        <span class="keyword">return</span> <span class="built_in">this</span>.publish(ObjectEventNotifier.Type.Create, target)
            .then(Mono.just(target));
    }

    <span class="keyword">public</span> &lt;T&gt; Mono&lt;T&gt; <span class="title function_">publishUpdate</span><span class="params">(T target)</span> {
        <span class="keyword">return</span> <span class="built_in">this</span>.publish(ObjectEventNotifier.Type.Update, target)
            .then(Mono.just(target));
    }

    <span class="keyword">public</span> &lt;T&gt; Mono&lt;T&gt; <span class="title function_">publishDelete</span><span class="params">(T target)</span> {
        <span class="keyword">return</span> <span class="built_in">this</span>.publish(ObjectEventNotifier.Type.Delete, target)
            .then(Mono.just(target));
    }

}</code></pre>

<p>Mainly the code of the publish part, the following publishCreate, etc., are for quick operation</p>
<h2 id="Try-the-written-Event-service"><a href="#Try-the-written-Event-service" class="headerlink" title="Try the written Event service"></a>Try the written Event service</h2><p>Create a cargo service</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GoodsService</span> {

    <span class="meta">@Resource</span>
    <span class="keyword">private</span> EventService eventService;

    <span class="keyword">public</span> Mono&lt;Goods&gt; <span class="title function_">createGoods</span><span class="params">()</span> {
        <span class="type">Goods</span> <span class="variable">apple</span> <span class="operator">=</span> Goods.of(<span class="number">1</span>, <span class="string">"苹果"</span>);
        <span class="keyword">return</span> Mono.just(apple)
            .flatMap(eventService::publishCreate);
    }

}</code></pre>

<p>Create a monitoring service for Goods (create two, after all, this kind of monitoring is generally one-to-many)</p>
<pre><code class="highlight java"><span class="meta">@Configuration</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfiguration</span> {

    <span class="meta">@Bean</span>
    <span class="keyword">public</span> GoodsService <span class="title function_">goodsService</span><span class="params">()</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GoodsService</span>();
    }

    <span class="meta">@Bean</span>
    <span class="keyword">public</span> StockService <span class="title function_">stockService</span><span class="params">()</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StockService</span>();
    }

    <span class="meta">@Bean</span>
    <span class="keyword">public</span> EventListener&lt;Goods&gt; <span class="title function_">listener1</span><span class="params">(StockService stockService)</span> {
        <span class="keyword">return</span> EventListener.register(Goods.class, stockService::initStockWithGoods1);
    }

    <span class="meta">@Bean</span>
    <span class="keyword">public</span> EventListener&lt;Goods&gt; <span class="title function_">listener2</span><span class="params">(StockService stockService)</span> {
        <span class="keyword">return</span> EventListener.register(Goods.class, stockService::initStockWithGoods2);
    }

}

<span class="meta">@Slf4j</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StockService</span> {

    <span class="keyword">public</span> Publisher&lt;Void&gt; <span class="title function_">initStockWithGoods1</span><span class="params">(ObjectEventNotifier&lt;Goods&gt; notifier)</span> {
        ObjectEventNotifier.<span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> notifier.getType();
        <span class="keyword">if</span> (type == ObjectEventNotifier.Type.Create) {
            log.error(<span class="string">"Create stock for: "</span> + notifier.getObject().getName());
            <span class="keyword">return</span> Mono.just(Stock.of(<span class="number">1</span>, <span class="number">0</span>)).then();
        }
        <span class="keyword">return</span> Mono.empty();
    }

    <span class="keyword">public</span> Publisher&lt;Void&gt; <span class="title function_">initStockWithGoods2</span><span class="params">(ObjectEventNotifier&lt;Goods&gt; notifier)</span> {
        log.error(<span class="string">"Another listener for Goods: "</span> + notifier.getObject().getName());
        <span class="keyword">return</span> Mono.empty();
    }

}</code></pre>

<p>Create a test case that calls create apple</p>
<pre><code class="highlight java"><span class="meta">@SpringBootTest</span>
<span class="keyword">class</span> <span class="title class_">GoodsServiceTest</span> {

    <span class="meta">@Resource</span>
    GoodsService goodsService;

    <span class="meta">@Test</span>
    <span class="keyword">void</span> <span class="title function_">createGoods</span><span class="params">()</span> {
        goodsService.createGoods()
            .as(StepVerifier::create)
            .expectNextCount(<span class="number">1</span>)
            .verifyComplete();
    }
}</code></pre>

<p>Running, we can see the following results, indicating that when the apple was created, two methods in the inventory were called</p>
<h2 id="The-source-code-is-here"><a href="#The-source-code-is-here" class="headerlink" title="The source code is here"></a>The source code is here</h2><blockquote>
<p>Source code: <a target="_blank" rel="nofollow noopener noreferer noreferrer external" href="https://www.webmanajemen.com/page/safelink.html?url=aHR0cHM6Ly9naXRodWIuY29tL2ppYW5ndGotbGFiL2V4LWZsdXgtZXZlbnQ=" alt="Provide ApplicationEventPublisher for Spring WebFlux" title="Provide ApplicationEventPublisher for Spring WebFlux">https://github.com/jiangtj-lab/ex-flux-event</a></p>
</blockquote>
<blockquote>
<p>The progress of Spring’s support of the reactive technology stack for ApplicationEventPublisher can be seen in this Issue: <a target="_blank" rel="nofollow noopener noreferer noreferrer external" href="https://www.webmanajemen.com/page/safelink.html?url=aHR0cHM6Ly9naXRodWIuY29tL3NwcmluZy1wcm9qZWN0cy9zcHJpbmctZnJhbWV3b3JrL2lzc3Vlcy8yMTAyNQ==" alt="Provide ApplicationEventPublisher for Spring WebFlux" title="Provide ApplicationEventPublisher for Spring WebFlux">https://github.com/spring-projects/spring-framework/issues/21025</a></p>
</blockquote>

    </div>

    
    
    
      


    <footer class="post-footer"><div id="keywords">
  
  
</div>

          <div class="post-tags">
              <a href="/tags/java/" rel="tag"># java</a>
              <a href="/tags/springboot/" rel="tag"># springboot</a>
              <a href="/tags/webflux/" rel="tag"># webflux</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/10/vscode-settings-json-for-nunjucks-ejs.html" rel="prev" title="VSCode settings JSON for nunjucks and EJS">
                  <i class="fa fa-chevron-left"></i> VSCode settings JSON for nunjucks and EJS
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/NodeJS/npm-yarn-package-agent-for-china.html" rel="next" title="NPM Package Agent For Programmer In China">
                  NPM Package Agent For Programmer In China <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  © 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dimas Lanjaka</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>


  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"dimaslanjaka","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

<div id="ykth" class="ykth-hide">
  <div class="ykth-inner">
    <div class="ykth-head">
      <svg style="width: 30px; height: 30px" viewBox="0 0 26 26">
        <path fill="#FFFFFF" d="M13,13H11V7H13M12,17.3A1.3,1.3 0 0,1 10.7,16A1.3,1.3 0 0,1 12,14.7A1.3,1.3 0 0,1 13.3,16A1.3,1.3 0 0,1 12,17.3M15.73,3H8.27L3,8.27V15.73L8.27,21H15.73L21,15.73V8.27L15.73,3Z"></path>
      </svg>
      <b>Adblock detected</b>
      <p>We have detected that you are using adblock in your browser</p>
      <i class="close" id="close-notif">×</i>
    </div>
    <div class="ykth-body">
      <p>
        We have detected that you are using adblock in your browser on page
        <b id="adblock-page-title">
          
          Provide ApplicationEventPublisher for Spring WebFlux
          
        </b>
        you've visited.
      </p>
      <p>
        Our website is made possible by displaying online advertisements to our
        visitors.
      </p>
      <ul>
        Our advertiser
        <li>Google Adsense</li>
      </ul>
      <p>
        Please consider supporting us by disabling your ad blocker. Thank you.
      </p>
    </div>
    
    <noscript>
      <div class="ykth-body">
        <p>Javascript is disabled in your web browser.</p>
        <p>
          For full functionality of this site it is necessary to enable
          JavaScript. Here are the
          <a href="https://www.webmanajemen.com/page/safelink.html?url=aHR0cHM6Ly93d3cuZW5hYmxlLWphdmFzY3JpcHQuY29tLw==" target="_blank">
            instructions how to enable JavaScript in your web browser</a>.
        </p>
      </div>
      <style>
        #ykth {
          display: block !important;
        }

        .ykth-inner > .ykth-body {
          display: none;
        }

        .ykth-head > b,
        .ykth-head > p {
          font-size: 0;
        }

        .ykth-head > b:before {
          content: 'Javascript Detected';
          font-size: 16px;
        }

        .ykth-head > p:before {
          content: 'We have detected that you are disable javascript in your browser';
          font-size: 14px;
        }
      </style>
    </noscript>
    
  </div>
</div>

<script src="/assets/adblock-notify/script.js"></script>
<link rel="stylesheet" href="/assets/adblock-notify/style.css">
<script>
  document.addEventListener('DOMContentLoaded', function (event) {
    setTimeout(() => {
      const titleBold = document.getElementById('adblock-page-title');
      if (titleBold) {
        const contains404 = /404/i.test(titleBold.textContent);
        const isWMI = /^wmi$/i.test(titleBold.textContent.trim());
        const isEmpty = titleBold.textContent.trim().length === 0;
        if (contains404 || isWMI || isEmpty) {
          titleBold.textContent = document.title;
        }
      }
    }, 1000);
  });
</script>
<script src="/r-ads.js"></script>
<style>
  .bannerAds {
    display: block;
    background: #fff url(//i.imgur.com/mBbv90p.png) no-repeat top right;
    color: #303030;
    min-height: 180px;
    min-width: 250px;
    text-align: center;
    margin-left: auto;
    margin-right: auto;
  }
</style>


<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(91118654, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/91118654" style="position:absolute; left:-9999px;" alt="Provide ApplicationEventPublisher for Spring WebFlux | WMI - https://mc.yandex.ru/watch/91118654"></div></noscript>

<script>
  (function () {
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>
<script id="ribbon" size="300" alpha="0.6" zindex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script>


</body></html>