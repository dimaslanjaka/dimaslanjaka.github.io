!function(){const leancloudSelector=e=>(e=encodeURI(e),document.getElementById(e).querySelector(".leancloud-visitors-count")),{app_id:e,app_key:t,server_url:o}=CONFIG.leancloud_visitors,fetchData=o=>{const Counter=(n,r,s)=>fetch(`${o}/1.1${r}`,{method:n,headers:{"X-LC-Id":e,"X-LC-Key":t,"Content-Type":"application/json"},body:JSON.stringify(s)});if(CONFIG.page.isPost){if(CONFIG.hostname!==location.hostname)return;(e=>{const t=document.querySelector(".leancloud_visitors"),o=decodeURI(t.id),n=t.dataset.flagTitle;e("get",`/classes/Counter?where=${encodeURIComponent(JSON.stringify({url:o}))}`).then((e=>e.json())).then((({results:t})=>{if(t.length>0){const n=t[0];leancloudSelector(o).innerText=n.time+1,e("put","/classes/Counter/"+n.objectId,{time:{__op:"Increment",amount:1}}).catch((e=>{console.error("Failed to save visitor count",e)}))}else CONFIG.leancloud_visitors.security?(leancloudSelector(o).innerText="Counter not initialized! More info at console err msg.",console.error("ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.")):e("post","/classes/Counter",{title:n,url:o,time:1}).then((e=>e.json())).then((()=>{leancloudSelector(o).innerText=1})).catch((e=>{console.error("Failed to create",e)}))})).catch((e=>{console.error("LeanCloud Counter Error",e)}))})(Counter)}else document.querySelectorAll(".post-title-link").length>=1&&(e=>{const t=[...document.querySelectorAll(".leancloud_visitors")].map((e=>decodeURI(e.id)));e("get",`/classes/Counter?where=${encodeURIComponent(JSON.stringify({url:{$in:t}}))}`).then((e=>e.json())).then((({results:e})=>{for(const o of t){const t=e.find((e=>e.url===o));leancloudSelector(o).innerText=t?t.time:0}})).catch((e=>{console.error("LeanCloud Counter Error",e)}))})(Counter)};let n;o?n=o:"-MdYXbMMI"===e.slice(-9)&&(n=`https://${e.slice(0,8).toLowerCase()}.api.lncldglobal.com`),document.addEventListener("page:loaded",(()=>{n?fetchData(n):fetch(`https://app-router.leancloud.cn/2/route?appId=${e}`).then((e=>e.json())).then((({api_server:e})=>{fetchData(`https://${e}`)}))}))}();