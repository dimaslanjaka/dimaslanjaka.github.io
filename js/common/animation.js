!function(t){function i(){this.record=[],this.timeoutMap={},this.listeners={start:[],frame:[],end:[]},this.frames=0,this._init()}i.prototype={_init:function(){return this.index=0,this.nowIndex=0,this.timer=null,this.time=0,this.startTime=null,this.record.forEach((function(t){eachObj(t,(function(i,e){~e.indexOf("_")||(t[e].now=t[e].from)}))})),this},_getSpendTime:function(){var t=this.time,i=this.nowIndex;return t-this.record.reduce((function(t,e,n){return n<i&&(t+=e._time),t}),0)},_request:function(t){var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;return this.timer=i(t),this},_cancel:function(){return(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame)(this.timer),this},_algorithm:function(t){var i=t.type||"linear",e=t.time||1e3,n=t.now,r=t.aims||0,o=t.spendTime||0;switch(i){case"linear":return function(t){var i=t.time,e=t.now,n=t.aims,r=e+60*(n-e)/(i-t.spendTime);return n-e>0?r>=n?n:r:r<=n?n:r}({time:e,now:n,aims:r,spendTime:o})}},_emit:function(t,i){return this.listeners[t]&&this.listeners[t].forEach((function(t){t(i)})),this},on:function(t,i){return~getKeys(this.listeners).indexOf(t)&&i&&this.listeners[t].push(i),this},from:function(t){t=t||{};var i=this.record[this.index]||{};return eachObj(t,(function(t,e){i[e]={from:t,now:t,to:0}})),this.record[this.index]=i,this},to:function(t){t=t||{};var i=this.record[this.index]||{};return eachObj(t,(function(t,e){i[e]=extend(i[e]||{from:0,now:0},{to:t})})),this.record[this.index]=i,this},transition:function(t){var i,e;"string"==typeof t?e=t:(i=t.type||"linear",e=t.time||1e3);var n=this.record[this.index]||{};return extend(n,{_time:e,_type:i}),this.record[this.index]=n,this},next:function(){return this.index=this.record.length,this},timeout:function(t){if(t&&"number"==typeof t){var i=0===this.record.length?-1:this.index;this.timeoutMap[i]=null!=this.timeoutMap[i]?this.timeoutMap[i]+t:t}return this},start:function(){var t=this.record,i=this;return this.next()._emit("start")._request((function e(){var n=t[i.nowIndex],r={};if(!i.startTime&&i.timeoutMap[-1])return i.startTime=(new Date).getTime(),i.pause(),void setTimeout((function(){i._request(e)}),i.timeoutMap[-1]);if(i.time===n._time){var o=i.timeoutMap[i.nowIndex];if(i.time=0,i.nowIndex++,o)return i.pause(),void setTimeout((function(){i._request(e)}),o);n=t[i.nowIndex]}i.nowIndex!==t.length?(eachObj(n,(function(t,e){if(!~e.indexOf("_")){var o=i._algorithm({type:n._type,time:n._time,now:t.now,aims:t.to,spendTime:i.time});r[e]=o,n[e].now=o,o===t.to&&(i.time=n._time)}})),i.time!=n._time&&(i.time+=60),i._emit("frame",r),i.frames++,i._request(e)):i._emit("end").close()}))},pause:function(){return this._cancel()},close:function(){return this._cancel()._init()}},t.Amt=i}(window);