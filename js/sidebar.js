$(document).ready((function(){var t=CONFIG.sidebar&&CONFIG.sidebar.tocMaxDepth||4,e="h1,h2,h3,h4,h5,h6,".slice(0,3*t).slice(0,-1);var o=null,s=null,i=!1;function a(){var t=$(".post-body, .custompage"),a=$(".sidebar-toc li"),n=t.find(e),r=n.first();if(n.each((function(){this.getBoundingClientRect().top<=5&&(o=window.encodeURIComponent(this.getAttribute("id")))})),t[0]&&r[0]&&r[0].getBoundingClientRect().top>0&&r.offset().top-$(window).scrollTop()>0)i||(a.removeClass("active current"),i=!0);else if(o!==s){var d=$('.sidebar-toc a[href="#'+o+'"]');if(!d.length){var c=window.decodeURIComponent(o);d=$('.sidebar-toc a[href="#'+c+'"]')}a.removeClass("active current"),d.parents("li").addClass("active"),d.parent().addClass("current"),s=o,i=!1}}var n=!1;function r(){var t=$(".sidebar-toc").height();if(!($(".sidebar-toc > div").height()<=t)){var e=$(".sidebar-toc"),o=$(".sidebar-toc .current a");if(o[0]&&e[0]){var s=o.offset().top-e.offset().top;n=s>t||s<0}n&&o.velocity("stop").velocity("scroll",{container:e,offset:-t/2,duration:500,easing:"easeOutQuart"})}}var d=0;function c(){var t=$("#sidebar");document.getElementById("content-wrap").getBoundingClientRect().top<d?t.addClass("sidebar--sticky"):t.removeClass("sidebar--sticky")}function l(){if(0!==$("#is-post").length){var t=$(".content"),e=t.offset().top,o=0,s=!1,i=0;CONFIG.postWidget&&CONFIG.postWidget.endText&&(s=!0),o=s?$(".post-ending").offset().top-e+$(".post-ending").outerHeight():$(".post-footer").offset().top-e;var a=$(window).height(),n=0;0!==t.length&&(n=parseInt(-1*t[0].getBoundingClientRect().top)+a);var r=Number($(".sidebar-reading-info__num").text());o=parseInt(Math.abs(o)),0===(i=(i=parseInt(n/o*100))>100?100:i<0?0:i)&&0===r||100===i&&100===r||($(".sidebar-reading-info__num").text(i),$(".sidebar-reading-line").css("transform","translateX("+(i-100)+"%)"))}}CONFIG.sidebar&&CONFIG.sidebar.offsetTop&&(d=parseInt(CONFIG.sidebar.offsetTop)),a(),c(),r(),l(),$(window).on("scroll",(function(){c()})),$(window).on("scroll",Stun.utils.throttle((function(){a(),r(),l()}),150)),Stun.utils.pjaxReloadSidebar=function(){var t=$(".sidebar-nav-toc"),o=$(".sidebar-nav-ov"),s=$(".sidebar-toc"),i=$(".sidebar-ov");t.on("click",(function(e){e.stopPropagation(),$(this).hasClass("current")||(t.addClass("current"),o.removeClass("current"),s.css("display","block"),s.velocity("stop").velocity("fadeIn"),i.css("display","none"),i.velocity("stop").velocity("fadeOut"))})),o.on("click",(function(e){e.stopPropagation(),$(this).hasClass("current")||(o.addClass("current"),t.removeClass("current"),s.css("display","none"),s.velocity("stop").velocity("fadeOut"),i.css("display","block"),i.velocity("stop").velocity("fadeIn"))})),$(".post-body, .custompage").find(e)[0]||($(".sidebar-nav").addClass("hide"),$(".sidebar-toc").addClass("hide"),$(".sidebar-ov").removeClass("hide"))},Stun.utils.pjaxReloadSidebar()}));